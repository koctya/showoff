!SLIDE subsection

# Exercises:

> Remember, any code listing with `\` on the end of a line means that line was too long to fit on the slide. the `\` should be deleted and the following line concatenated.
!SLIDE small

# Commenting for Notes

We are going to add the possibility to comment on notes in your application.

The instructions for installing rails and building the notes app can be found here.

!SLIDE small

## Create comment scaffold

Create a comment scaffold, with the commentator name, the comment body (contents of the comment) and with the reference to the notes table (`note_id`).

	rails g scaffold comment user_name:string body:text note_id:integer

This will create a migration file that lets your database know about the new comments table. Run the migrations using

	rake db:migrate

!SLIDE small

## Add relations to models

You need to make sure that Rails knows the relation between objects (notes and comments). As one note can have many comments we need to make sure the note model knows that. Open `app/models/note.rb` and after the row

	@@@ ruby
	class Note < ActiveRecord::Base

add

	@@@ ruby
	has_many :comments

The comment also has to know that it belongs to an note. So open `app/models/comment.rb` and after

	@@@ ruby
	class Comment < ActiveRecord::Base

add the row

	@@@ ruby
	belongs_to :note

!SLIDE small

## Render the comment form and existing comments

Open `app/views/notes/show.html` and after the `image_tag`

	@@@ ruby
	= image_tag(@note.picture_url, :width => 600) \
		if @note.picture.present?

add

	@@@ haml
	%h3 Comments
	- @comments.each do |comment|
	  %div
	    %strong= comment.user_name
	    %br
	    %p= comment.body
	    %p= link_to 'Delete', comment_path(comment), \
			method: :delete, \
			data: { confirm: 'Are you sure?' }
	= render 'comments/form'

!SLIDE small

In `app/controllers/notes_controller.rb` add to show action after the row

	@@@ ruby
	@note = Note.find(params[:id])

this

	@@@ ruby
	@comments = @note.comments.all
	@comment = @note.comments.build

!SLIDE small

Open `app/views/comments/_form.html.haml` and after

	@@@ ruby
	.field
	  = f.label :body
	  %br
	  = f.text_area :body

add the row

	@@@ ruby
	= f.hidden_field :note_id

!SLIDE small

next, remove

	@@@ ruby
	.field
	  = f.label :note_id
	  %br
	  = f.number_field :note_id

That’s it. Now view an note you have inserted to your application and there you should see the form for inserting a comment as well as deleting older comments.


!SLIDE small

# Create thumbnails with Carrierwave

!SLIDE small

## Installing ImageMagick

- OS X: run `brew install imagemagick`. If you don’t have the brew command, you can install [Homebrew](http://mxcl.github.io/homebrew/) here.

- Linux: On Ubuntu and Debian, run `sudo apt-get install imagemagick`. Use the appropriate package manager instead of apt-get for other distributions.

Open Gemfile in the project and add

	@@@ ruby
	gem 'mini_magick', '3.8.0'
under the line

	@@@ ruby
	gem 'carrierwave'
In the Terminal run:

	bundle

!SLIDE small

## Telling our app to create thumbnails when an image is uploaded

Open `app/uploaders/picture_uploader.rb` and find the line that looks like this:

	@@@ ruby
	# include CarrierWave::MiniMagick
Remove the `#` sign.

Below the line you just changed, add:

	@@@ ruby
	version :thumb do
	  process :resize_to_fill => [50, 50]
	end

The images uploaded from now on should be resized, but the ones we already have weren’t affected. So edit one of the existing notes and re-add a picture.

!SLIDE small

## Displaying the thumbnails

To see if the uploaded picture was resized open `app/views/notes/index.html.haml`. Change the line

	@@@ ruby
	%td= note.picture
to

	@@@ ruby
	%td= image_tag note.picture_url(:thumb) if note.picture?

Take a look at the list of notes in the browser to see if the thumbnail is there.

!SLIDE small

# Add design using HTML & CSS

Now the app is running well, but it still looks like scaffold.
Let’s add some design to make it look like a professional website.

!SLIDE small

## Adjust the application layout

First, let’s use bootstrap.min.css to apply a more lightweight style set to your app.


Open `app/assets/stylesheets/application.scss`, replace the line

	@@@ css
	body { padding-top: 100px; }
with

	@@@ css
	body { padding-top: 60px; }

Finally, delete the file `app/assets/stylesheets/scaffolds.css.scss` because we don’t really need the default style generated by Rails.

Now refresh the page at http://localhost:3000/notes. You will not find much change but it’s good preparation for the following steps.

!SLIDE small

## Refine the navigation

Considering “note” is the most important object in your app, we are going to put the “New Note” button on the navigation bar to make it always available.

Open `app/views/layouts/application.html.haml`, under the line

	@@@ ruby
	%li.active
	  %a{ :href => "/notes"} Notes
add

	@@@ ruby
	%li= link_to 'New Note', new_note_path

!SLIDE small
.notes Explain what the new code means line by line, and talk a little about Bootstrap 12 grids layout.

## Design the note list

Now it’s time to make the note list page look professional. For that, we are going to replace the table layout with a div layout.

Open `app/views/notes/index.html.haml` in your text editor and replace all lines with

	@@@ ruby
	%h1 Listing notes
	- @notes.in_groups_of(3) do |group|
	  .row
	    - group.compact.each do |note|
	      .span4
	        = image_tag note.picture_url(:thumb) \
				 if note.picture.present?
	        %h4= link_to note.name, note
	        = note.description


!SLIDE small

Refresh it! We get a nice looking note list. Click the “New Note” button, and create more notes with real text and pretty pictures - the page will look much better with content. There is a principle of contemporary web design: content is the best decoration.

!SLIDE small
.notes Explain what the new code means line by line.
## Design the note details page

Click the title of an note, and you will be brought to the details page of the note. Now it is still scaffold generated by Rails, so let’s make it better.


Open `app/views/notes/show.html.haml` in your text editor and replace all lines with

	@@@ ruby
	%p#notice= notice

	.row
	  .span9
	    = image_tag(@note.picture_url, :width => "100%") \
			if @note.picture.present?
	  .span3
	    %p
		  %bName:
		  = @note.name
	    %p
		  %bDescription:
		  = @note.description
	    %p
	      = link_to 'Edit', edit_note_path(@note)
		  \|
	      = link_to 'Destroy', @note, confirm: 'Are you sure?', \
		  	method: :delete
		  \|
	      = link_to 'Back', notes_path

!SLIDE subsection

# Rails exercise - Contacts:

Try to Create a new Rails Contacts Application using the tools and techniques you've learned so far.

!SLIDE small

- Use the Bootstrap Gem for layout and styling.

- A Contact should have;
	- Name
	- Email
	- Phone
	- (optional business name)
	- 1 or more Addresses (ie a separate model with relation)

!SLIDE small

- An Address should have;
	- Type (work, home, vacation, etc)
	- Street
	- City
	- Zip
	- Country

!SLIDE small
## Additional optional features

- Add Photos to the Contact
- Your own features ???

!SLIDE small

## What next?

Use your new knowledge to design the new note form
Add more design to the pages as you wish
Follow the other guides to learn more about Rails